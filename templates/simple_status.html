<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Processing Status - YouTube Clips Generator</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f5f5f5;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .main-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #d9534f;
            font-weight: 700;
        }
        .status-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .clip-card {
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }
        .clip-card:hover {
            transform: translateY(-5px);
        }
        .clip-card video {
            width: 100%;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }
        .btn-primary {
            background-color: #d9534f;
            border-color: #d9534f;
        }
        .btn-primary:hover {
            background-color: #c9302c;
            border-color: #c9302c;
        }
        .alert-info {
            background-color: #d9edf7;
            border-color: #bce8f1;
            color: #31708f;
        }
        .alert-success {
            background-color: #dff0d8;
            border-color: #d6e9c6;
            color: #3c763d;
        }
        .progress-bar {
            background-color: #5bc0de;
        }
    </style>
</head>
<body>
    <div class="container main-container">
        <div class="header">
            <h1>YouTube Clips Generator</h1>
            <a href="/" class="btn btn-outline-secondary mt-2">‚Üê Back to Home</a>
        </div>

        <div class="status-card">
            <h3>Processing Status</h3>
            <div id="status-message" class="alert {{ 'alert-info' if task.status == 'processing' else 'alert-success' if task.status == 'completed' else 'alert-danger' }}">
                {{ task.message }}
            </div>
            
            <div class="progress mb-3" id="progress-bar-container" {{ 'style=display:none;' if task.status != 'processing' else '' }}>
                <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated" 
                     role="progressbar" style="width: {{ task.progress }}%;" 
                     aria-valuenow="{{ task.progress }}" aria-valuemin="0" aria-valuemax="100">
                    {{ task.progress }}%
                </div>
            </div>
            
            <p>URL: <a href="{{ task.url }}" target="_blank">{{ task.url }}</a></p>
        </div>

        <div id="clips-container" class="{{ 'd-none' if task.status != 'completed' }}">
            <h3 class="mb-3">Most Engaging Clips Generated (9:16 Ratio)</h3>
            <p class="text-muted mb-4">We've analyzed your video to extract the most engaging parts and formatted them for Instagram and other social media platforms.</p>
            <div class="row">
                {% for clip in task.clips %}
                <div class="col-md-4 mb-4">
                    <div class="card clip-card">
                        <video controls>
                            <source src="{{ url_for('download_file', filename=clip.path) }}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                        <div class="card-body">
                            <h5 class="card-title">Clip {{ clip.id }}</h5>
                            <p class="card-text">Start: {{ '%0.1f'|format(clip.start_time) }}s</p>
                            <a href="{{ url_for('download_file', filename=clip.path) }}" class="btn btn-primary">Download</a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Only run the status updater if we're still processing
        {% if task.status == 'processing' %}
        // Poll for status updates
        function updateStatus() {
            fetch('/check_status/{{ task_id }}')
                .then(response => response.json())
                .then(data => {
                    // Update the status message
                    const statusEl = document.getElementById('status-message');
                    statusEl.textContent = data.message;
                    
                    // Update the progress bar
                    const progressBar = document.getElementById('progress-bar');
                    progressBar.style.width = data.progress + '%';
                    progressBar.setAttribute('aria-valuenow', data.progress);
                    progressBar.textContent = data.progress + '%';
                    
                    // Update the status class
                    if (data.status === 'completed') {
                        statusEl.className = 'alert alert-success';
                        document.getElementById('progress-bar-container').style.display = 'none';
                        
                        // Show the clips
                        document.getElementById('clips-container').classList.remove('d-none');
                        
                        // Reload the page to show clips
                        location.reload();
                        return;
                    } else if (data.status === 'error') {
                        statusEl.className = 'alert alert-danger';
                        document.getElementById('progress-bar-container').style.display = 'none';
                        return;
                    }
                    
                    // Continue polling if still processing
                    if (data.status === 'processing') {
                        setTimeout(updateStatus, 3000);
                    }
                })
                .catch(error => {
                    console.error('Error checking status:', error);
                    setTimeout(updateStatus, 5000);  // Retry after 5 seconds
                });
        }
        
        // Start polling when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(updateStatus, 3000);
        });
        {% endif %}
    </script>
</body>
</html> 